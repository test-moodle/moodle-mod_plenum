define("plenumform_jitsi/media_manager",["exports","core/ajax","plenumform_jitsi/external_api","core/notification","core/templates"],(function(_exports,_ajax,_external_api,_notification,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * Plenary meeting Jitsi integration media manager
   *
   * @package    plenumform_jitsi
   * @module     plenumform_jitsi/media_manager
   * @copyright  2023 Daniel Thies
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_ajax=_interopRequireDefault(_ajax),_external_api=_interopRequireDefault(_external_api),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);var domain,options={configOverwrite:{startWithAudioMuted:!0},width:700,height:700,parentNode:document.querySelector("#meet")};_exports.default=class{constructor(contextid,delay,server,room,userinfo,jwt){return this.contextid=contextid,domain=server,options.userInfo=userinfo,options.roomName=room,options.contextid=contextid,jwt&&(options.jwt=jwt),!!delay&&(setInterval((()=>{this.updateMotions(contextid)}),delay),document.addEventListener("click",handleClick),!0)}async updateMotions(contextid){const selector=`[data-contextid="${contextid}"][data-region="plenum-motions"]`,content=document.querySelector(selector);if(content){const response=await _ajax.default.call([{args:{contextid:contextid},contextid:contextid,fail:_notification.default.exception,methodname:"mod_plenum_update_content"}])[0];response.motions&&_templates.default.replaceNodeContents(content,response.motions,response.javascript)}}};const register=()=>_ajax.default.call([{args:{contextid:Number(options.contextid),join:!0},contextid:options.contextid,fail:_notification.default.exception,methodname:"plenumform_jitsi_join_room"}])[0],leave=()=>_ajax.default.call([{args:{contextid:Number(options.contextid),join:!1},contextid:options.contextid,fail:_notification.default.exception,methodname:"plenumform_jitsi_join_room"}])[0],raiseHand=e=>_ajax.default.call([{args:{contextid:Number(options.contextid),raisehand:!!e.handRaised},contextid:options.contextid,fail:_notification.default.exception,methodname:"plenumform_jitsi_raise_hand"}])[0],handleClick=e=>{const button=e.target.closest('button[data-action="joinroom"]');if(button){const api=new _external_api.default(domain,options);button.classList.add("hidden"),options.parentNode.classList.remove("hidden"),api.addListener("readyToClose",(()=>{button.classList.remove("hidden"),options.parentNode.classList.add("hidden"),api.dispose()})),api.addListener("videoConferenceJoined",register),api.addListener("videoConferenceLeft",leave),api.addListener("raiseHandUpdated",raiseHand)}};return _exports.default}));

//# sourceMappingURL=media_manager.min.js.map